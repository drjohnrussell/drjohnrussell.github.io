{
  "hash": "bdf14d377919a8b68714ef4e73df2e42",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tidy Tuesday - Looking at Scottish Munros\"\ndescription: \"Converting Coordinate Systems for the tidyverse\"\ndate: 08-20-2025\ncategories: [R, Geography, TidyTuesday] # self-defined categories\nformat:\n  html:\n    code-fold: show\n    code-summary: \"Code in R\"\n    toc: TRUE\n    toc_float: TRUE\nexecute:\n  warning: false\ncitation: \n  url: https://drjohnrussell.github.io/posts/2025-08-20-Scottish-Munros/ \nimage: img/scotlandmap.png\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n---\n\n\n\n## Getting back Into It\n\nIt's been a while for this website; a lot of my work has been used on projects that can't be easily shared here. That said, I have been at the Edinburgh Fringe this month supporting my wife, and I wanted to use a Tidy Tuesday dataset to refresh some skills.\n\n### Loading necessary packages and the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(rnaturalearth)\nlibrary(ggview)\n\ntuesdata <- tidytuesdayR::tt_load(2025, week = 33)\n\nscottish_munros <- tuesdata$scottish_munros\n```\n:::\n\n\n### Getting a base map of Scotland, with some bodies of water\n\nThe first thing we will need is a map of scotland, and to see if we can put any major bodies of water in it. We can use the `rnaturalearth` package for this, with the caveat that bodies of water have to be pretty large for it them to show up!\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscotland <- ne_countries(geounit = \"scotland\", type = \"map_units\", scale=\"large\")\n\nwater <- ne_download(scale=10, type=\"lakes\", category=\"physical\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `ne_10m_lakes' from data source \n  `C:\\Users\\russe\\AppData\\Local\\Temp\\Rtmp2dZUJn\\ne_10m_lakes.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 1355 features and 41 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -165.9656 ymin: -50.66967 xmax: 177.1544 ymax: 81.95521\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nriver <- ne_download(scale=10, type=\"rivers_lake_centerlines\", category=\"physical\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `ne_10m_rivers_lake_centerlines' from data source \n  `C:\\Users\\russe\\AppData\\Local\\Temp\\Rtmp2dZUJn\\ne_10m_rivers_lake_centerlines.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 1473 features and 38 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: -164.9035 ymin: -52.15775 xmax: 177.5204 ymax: 75.79348\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n:::\n\n\n\nNow that we have rivers and lakes, we can us the `sf` package to provide a filter that just looks for rivers and lakes that are within the scotland shapefile's latitude and longitude.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsf_use_s2(FALSE)\n\nwaterscotland <- st_filter(water,scotland)\nriverscotland <- st_filter(river, scotland)\n```\n:::\n\n\n\n### Working across coordinate systems\n\nIn the Tidy Tuesday dataset, the Scottish Munros are in British National Grid (OSGB36, or CRS 27700), which is a coordinate system based on meters eastward and northward from a point outside of the Southern and Westernmost point of Britain (ignoring Northern Island).\n\nBecause our geometry is standard World Geodetic System, it is easiest to translate to this system (CRS 4326). Finally, we should pull the coordinates for plotting.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprojection <- st_as_sf(scottish_munros |> \n                         filter(!is.na(xcoord),\n                                !is.na(ycoord)),\n                       coords=c(\"xcoord\",\"ycoord\"),\n                       crs = 27700) |> \n  st_transform(crs=4326) |> \n  st_coordinates()\n\nscottish_munros <- scottish_munros |> \n  filter(!is.na(xcoord)) |> \n  cbind(projection)\n```\n:::\n\n\n\n### Making our map\n\nWe now have everything to make our map. I take advantage of `ggview` for outputting this, with that code in comments.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap <- scotland |> \n  ggplot() +\n  geom_sf() +\n  geom_sf(data=waterscotland, fill=\"blue\") +\n  geom_sf(data=riverscotland, color=\"blue\") +\n  geom_point(data=scottish_munros |> \n               filter(!is.na(`2021`)), \n             aes(x=X, y=Y, color=`2021`),shape=\"^\", size=3) +\n  theme_light() +\n  coord_sf(xlim=c(-10,0)) +\n  scale_color_brewer(palette=\"Dark2\", direction=-1) +\n  labs(color=\"\",\n       title=\"Munros of Scotland, as classified in 2021\",\n       subtitle=\"Effect of the Great-Glen Fault\",\n       caption=\"TidyTuesday\") +\n  theme(legend.position=\"bottom\",\n        legend.margin=margin(0,0,0,0),\n        plot.title.position=\"plot\",\n        axis.title = element_blank(),\n        panel.background = element_rect(fill=\"lightblue\"),\n        legend.key = element_rect(fill = NA))\n\nmap\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# map + canvas(width=4.5, height=4.5, units=\"in\")\n\n# ggsave(map, width=4.5, height=4.5, units=\"in\", filename=\"img/scotlandmap.png\")\n```\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}